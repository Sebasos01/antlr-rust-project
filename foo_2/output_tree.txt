File: /home/socub/U/tesis/foo_2/memory.rs
crate
  item
    visItem
      visibility
        pub
      function_
        functionQualifiers
        fn
        identifier
          physmap
        (
        functionParameters
          functionParam
            functionParamPattern
              pattern
                patternNoTopAlt
                  patternWithoutRange
                    identifierPattern
                      identifier
                        physical_address
              :
              type_
                typeNoBounds
                  traitObjectTypeOneBound
                    traitBound
                      typePath
                        typePathSegment
                          pathIdentSegment
                            identifier
                              usize
          ,
          functionParam
            functionParamPattern
              pattern
                patternNoTopAlt
                  patternWithoutRange
                    identifierPattern
                      identifier
                        size
              :
              type_
                typeNoBounds
                  traitObjectTypeOneBound
                    traitBound
                      typePath
                        typePathSegment
                          pathIdentSegment
                            identifier
                              usize
          ,
          functionParam
            functionParamPattern
              pattern
                patternNoTopAlt
                  patternWithoutRange
                    identifierPattern
                      identifier
                        flags
              :
              type_
                typeNoBounds
                  traitObjectTypeOneBound
                    traitBound
                      typePath
                        typePathSegment
                          pathIdentSegment
                            identifier
                              MapFlags
          ,
          functionParam
            functionParamPattern
              pattern
                patternNoTopAlt
                  patternWithoutRange
                    identifierPattern
                      identifier
                        memory_type
              :
              type_
                typeNoBounds
                  traitObjectTypeOneBound
                    traitBound
                      typePath
                        typePathSegment
                          pathIdentSegment
                            identifier
                              MemoryType
          ,
        )
        functionReturnType
          ->
          type_
            typeNoBounds
              traitObjectTypeOneBound
                traitBound
                  typePath
                    typePathSegment
                      pathIdentSegment
                        identifier
                          Result
                      genericArgs
                        <
                        genericArgsTypes
                          type_
                            typeNoBounds
                              traitObjectTypeOneBound
                                traitBound
                                  typePath
                                    typePathSegment
                                      pathIdentSegment
                                        identifier
                                          usize
                        >
        blockExpression
          {
          statements
            statement
              letStatement
                let
                patternNoTopAlt
                  patternWithoutRange
                    identifierPattern
                      identifier
                        end
                =
                expression
                  expression
                    literalExpression
                      1
                  shl
                    <
                    <
                  expression
                    literalExpression
                      52
                ;
            statement
              expressionStatement
                expressionWithBlock
                  ifExpression
                    if
                    expression
                      expression
                        expression
                          (
                          expression
                            expression
                              expression
                                pathExpression
                                  pathInExpression
                                    pathExprSegment
                                      pathIdentSegment
                                        identifier
                                          physical_address
                              .
                              pathExprSegment
                                pathIdentSegment
                                  identifier
                                    saturating_add
                              (
                              callParams
                                expression
                                  pathExpression
                                    pathInExpression
                                      pathExprSegment
                                        pathIdentSegment
                                          identifier
                                            size
                              )
                            as
                            typeNoBounds
                              traitObjectTypeOneBound
                                traitBound
                                  typePath
                                    typePathSegment
                                      pathIdentSegment
                                        identifier
                                          u64
                          )
                        comparisonOperator
                          >
                        expression
                          pathExpression
                            pathInExpression
                              pathExprSegment
                                pathIdentSegment
                                  identifier
                                    end
                      ||
                      expression
                        expression
                          expression
                            pathExpression
                              pathInExpression
                                pathExprSegment
                                  pathIdentSegment
                                    identifier
                                      physical_address
                          %
                          expression
                            pathExpression
                              pathInExpression
                                pathExprSegment
                                  pathIdentSegment
                                    identifier
                                      PAGE_SIZE
                        comparisonOperator
                          !=
                        expression
                          literalExpression
                            0
                    blockExpression
                      {
                      statements
                        statement
                          expressionStatement
                            expression
                              return
                              expression
                                expression
                                  pathExpression
                                    pathInExpression
                                      pathExprSegment
                                        pathIdentSegment
                                          identifier
                                            Err
                                (
                                callParams
                                  expression
                                    expression
                                      pathExpression
                                        pathInExpression
                                          pathExprSegment
                                            pathIdentSegment
                                              identifier
                                                Error
                                          ::
                                          pathExprSegment
                                            pathIdentSegment
                                              identifier
                                                new
                                    (
                                    callParams
                                      expression
                                        pathExpression
                                          pathInExpression
                                            pathExprSegment
                                              pathIdentSegment
                                                identifier
                                                  EINVAL
                                    )
                                )
                            ;
                      }
            statement
              expressionStatement
                expressionWithBlock
                  ifExpression
                    if
                    expression
                      expression
                        expression
                          pathExpression
                            pathInExpression
                              pathExprSegment
                                pathIdentSegment
                                  identifier
                                    size
                        %
                        expression
                          pathExpression
                            pathInExpression
                              pathExprSegment
                                pathIdentSegment
                                  identifier
                                    PAGE_SIZE
                      comparisonOperator
                        !=
                      expression
                        literalExpression
                          0
                    blockExpression
                      {
                      statements
                        statement
                          item
                            macroItem
                              macroInvocationSemi
                                simplePath
                                  simplePathSegment
                                    identifier
                                      log
                                  ::
                                  simplePathSegment
                                    identifier
                                      warn
                                !
                                (
                                tokenTree
                                  tokenTreeToken
                                    macroLiteralToken
                                      literalExpression
                                        "physmap size {} is not multiple of PAGE_SIZE {}"
                                  tokenTreeToken
                                    macroPunctuationToken
                                      ,
                                  tokenTreeToken
                                    macroIdentifierLikeToken
                                      identifier
                                        size
                                  tokenTreeToken
                                    macroPunctuationToken
                                      ,
                                  tokenTreeToken
                                    macroIdentifierLikeToken
                                      identifier
                                        PAGE_SIZE
                                )
                                ;
                        statement
                          expressionStatement
                            expression
                              return
                              expression
                                expression
                                  pathExpression
                                    pathInExpression
                                      pathExprSegment
                                        pathIdentSegment
                                          identifier
                                            Err
                                (
                                callParams
                                  expression
                                    expression
                                      pathExpression
                                        pathInExpression
                                          pathExprSegment
                                            pathIdentSegment
                                              identifier
                                                Error
                                          ::
                                          pathExprSegment
                                            pathIdentSegment
                                              identifier
                                                new
                                    (
                                    callParams
                                      expression
                                        pathExpression
                                          pathInExpression
                                            pathExprSegment
                                              pathIdentSegment
                                                identifier
                                                  EINVAL
                                    )
                                )
                            ;
                      }
            statement
              letStatement
                let
                patternNoTopAlt
                  patternWithoutRange
                    identifierPattern
                      identifier
                        page_count
                =
                expression
                  expression
                    expression
                      expression
                        pathExpression
                          pathInExpression
                            pathExprSegment
                              pathIdentSegment
                                identifier
                                  NonZeroUsize
                            ::
                            pathExprSegment
                              pathIdentSegment
                                identifier
                                  new
                      (
                      callParams
                        expression
                          expression
                            pathExpression
                              pathInExpression
                                pathExprSegment
                                  pathIdentSegment
                                    identifier
                                      size
                          .
                          pathExprSegment
                            pathIdentSegment
                              identifier
                                div_ceil
                          (
                          callParams
                            expression
                              pathExpression
                                pathInExpression
                                  pathExprSegment
                                    pathIdentSegment
                                      identifier
                                        PAGE_SIZE
                          )
                      )
                    .
                    pathExprSegment
                      pathIdentSegment
                        identifier
                          ok_or
                    (
                    callParams
                      expression
                        expression
                          pathExpression
                            pathInExpression
                              pathExprSegment
                                pathIdentSegment
                                  identifier
                                    Error
                              ::
                              pathExprSegment
                                pathIdentSegment
                                  identifier
                                    new
                        (
                        callParams
                          expression
                            pathExpression
                              pathInExpression
                                pathExprSegment
                                  pathIdentSegment
                                    identifier
                                      EINVAL
                        )
                    )
                  ?
                ;
            statement
              letStatement
                let
                patternNoTopAlt
                  patternWithoutRange
                    identifierPattern
                      identifier
                        current_addrsp
                =
                expression
                  expression
                    expression
                      pathExpression
                        pathInExpression
                          pathExprSegment
                            pathIdentSegment
                              identifier
                                AddrSpace
                          ::
                          pathExprSegment
                            pathIdentSegment
                              identifier
                                current
                    (
                    )
                  ?
                ;
            statement
              letStatement
                let
                patternNoTopAlt
                  patternWithoutRange
                    identifierPattern
                      identifier
                        base_page
                =
                expression
                  expression
                    expression
                      expression
                        pathExpression
                          pathInExpression
                            pathExprSegment
                              pathIdentSegment
                                identifier
                                  current_addrsp
                      .
                      pathExprSegment
                        pathIdentSegment
                          identifier
                            acquire_write
                      (
                      )
                    .
                    pathExprSegment
                      pathIdentSegment
                        identifier
                          mmap_anywhere
                    (
                    callParams
                      expression
                        &
                        expression
                          pathExpression
                            pathInExpression
                              pathExprSegment
                                pathIdentSegment
                                  identifier
                                    current_addrsp
                      ,
                      expression
                        pathExpression
                          pathInExpression
                            pathExprSegment
                              pathIdentSegment
                                identifier
                                  page_count
                      ,
                      expression
                        pathExpression
                          pathInExpression
                            pathExprSegment
                              pathIdentSegment
                                identifier
                                  flags
                      ,
                      expression
                        closureExpression
                          |
                          closureParameters
                            closureParam
                              pattern
                                patternNoTopAlt
                                  patternWithoutRange
                                    identifierPattern
                                      identifier
                                        dst_page
                            ,
                            closureParam
                              pattern
                                patternNoTopAlt
                                  patternWithoutRange
                                    identifierPattern
                                      mut
                                      identifier
                                        page_flags
                            ,
                            closureParam
                              pattern
                                patternNoTopAlt
                                  patternWithoutRange
                                    identifierPattern
                                      identifier
                                        dst_mapper
                            ,
                            closureParam
                              pattern
                                patternNoTopAlt
                                  patternWithoutRange
                                    identifierPattern
                                      identifier
                                        dst_flusher
                          |
                          expression
                            expressionWithBlock
                              blockExpression
                                {
                                statements
                                  statement
                                    expressionStatement
                                      expressionWithBlock
                                        matchExpression
                                          match
                                          expression
                                            pathExpression
                                              pathInExpression
                                                pathExprSegment
                                                  pathIdentSegment
                                                    identifier
                                                      memory_type
                                          {
                                          matchArms
                                            matchArm
                                              pattern
                                                patternNoTopAlt
                                                  patternWithoutRange
                                                    pathPattern
                                                      pathInExpression
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              MemoryType
                                                        ::
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              Writeback
                                            =>
                                            matchArmExpression
                                              expression
                                                (
                                                )
                                              ,
                                            matchArm
                                              outerAttribute
                                                #
                                                [
                                                attr
                                                  simplePath
                                                    simplePathSegment
                                                      identifier
                                                        cfg
                                                  attrInput
                                                    delimTokenTree
                                                      (
                                                      tokenTree
                                                        tokenTreeToken
                                                          macroIdentifierLikeToken
                                                            identifier
                                                              any
                                                      tokenTree
                                                        delimTokenTree
                                                          (
                                                          tokenTree
                                                            tokenTreeToken
                                                              macroIdentifierLikeToken
                                                                identifier
                                                                  target_arch
                                                            tokenTreeToken
                                                              macroPunctuationToken
                                                                =
                                                            tokenTreeToken
                                                              macroLiteralToken
                                                                literalExpression
                                                                  "x86"
                                                            tokenTreeToken
                                                              macroPunctuationToken
                                                                ,
                                                            tokenTreeToken
                                                              macroIdentifierLikeToken
                                                                identifier
                                                                  target_arch
                                                            tokenTreeToken
                                                              macroPunctuationToken
                                                                =
                                                            tokenTreeToken
                                                              macroLiteralToken
                                                                literalExpression
                                                                  "x86_64"
                                                          )
                                                      )
                                                ]
                                              pattern
                                                patternNoTopAlt
                                                  patternWithoutRange
                                                    pathPattern
                                                      pathInExpression
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              MemoryType
                                                        ::
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              WriteCombining
                                            =>
                                            matchArmExpression
                                              expressionWithBlock
                                                blockExpression
                                                  {
                                                  statements
                                                    expression
                                                      expression
                                                        pathExpression
                                                          pathInExpression
                                                            pathExprSegment
                                                              pathIdentSegment
                                                                identifier
                                                                  page_flags
                                                      =
                                                      expression
                                                        expression
                                                          pathExpression
                                                            pathInExpression
                                                              pathExprSegment
                                                                pathIdentSegment
                                                                  identifier
                                                                    page_flags
                                                        .
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              custom_flag
                                                        (
                                                        callParams
                                                          expression
                                                            expression
                                                              pathExpression
                                                                pathInExpression
                                                                  pathExprSegment
                                                                    pathIdentSegment
                                                                      identifier
                                                                        EntryFlags
                                                                  ::
                                                                  pathExprSegment
                                                                    pathIdentSegment
                                                                      identifier
                                                                        HUGE_PAGE
                                                            .
                                                            pathExprSegment
                                                              pathIdentSegment
                                                                identifier
                                                                  bits
                                                            (
                                                            )
                                                          ,
                                                          expression
                                                            literalExpression
                                                              true
                                                        )
                                                  }
                                            matchArm
                                              pattern
                                                patternNoTopAlt
                                                  patternWithoutRange
                                                    pathPattern
                                                      pathInExpression
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              MemoryType
                                                        ::
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              Uncacheable
                                            =>
                                            matchArmExpression
                                              expressionWithBlock
                                                blockExpression
                                                  {
                                                  statements
                                                    expression
                                                      expression
                                                        pathExpression
                                                          pathInExpression
                                                            pathExprSegment
                                                              pathIdentSegment
                                                                identifier
                                                                  page_flags
                                                      =
                                                      expression
                                                        expression
                                                          pathExpression
                                                            pathInExpression
                                                              pathExprSegment
                                                                pathIdentSegment
                                                                  identifier
                                                                    page_flags
                                                        .
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              custom_flag
                                                        (
                                                        callParams
                                                          expression
                                                            expression
                                                              pathExpression
                                                                pathInExpression
                                                                  pathExprSegment
                                                                    pathIdentSegment
                                                                      identifier
                                                                        EntryFlags
                                                                  ::
                                                                  pathExprSegment
                                                                    pathIdentSegment
                                                                      identifier
                                                                        NO_CACHE
                                                            .
                                                            pathExprSegment
                                                              pathIdentSegment
                                                                identifier
                                                                  bits
                                                            (
                                                            )
                                                          ,
                                                          expression
                                                            literalExpression
                                                              true
                                                        )
                                                  }
                                            matchArm
                                              outerAttribute
                                                #
                                                [
                                                attr
                                                  simplePath
                                                    simplePathSegment
                                                      identifier
                                                        cfg
                                                  attrInput
                                                    delimTokenTree
                                                      (
                                                      tokenTree
                                                        tokenTreeToken
                                                          macroIdentifierLikeToken
                                                            identifier
                                                              target_arch
                                                        tokenTreeToken
                                                          macroPunctuationToken
                                                            =
                                                        tokenTreeToken
                                                          macroLiteralToken
                                                            literalExpression
                                                              "aarch64"
                                                      )
                                                ]
                                              pattern
                                                patternNoTopAlt
                                                  patternWithoutRange
                                                    pathPattern
                                                      pathInExpression
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              MemoryType
                                                        ::
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              DeviceMemory
                                            =>
                                            matchArmExpression
                                              expressionWithBlock
                                                blockExpression
                                                  {
                                                  statements
                                                    expression
                                                      expression
                                                        pathExpression
                                                          pathInExpression
                                                            pathExprSegment
                                                              pathIdentSegment
                                                                identifier
                                                                  page_flags
                                                      =
                                                      expression
                                                        expression
                                                          pathExpression
                                                            pathInExpression
                                                              pathExprSegment
                                                                pathIdentSegment
                                                                  identifier
                                                                    page_flags
                                                        .
                                                        pathExprSegment
                                                          pathIdentSegment
                                                            identifier
                                                              custom_flag
                                                        (
                                                        callParams
                                                          expression
                                                            expression
                                                              pathExpression
                                                                pathInExpression
                                                                  pathExprSegment
                                                                    pathIdentSegment
                                                                      identifier
                                                                        EntryFlags
                                                                  ::
                                                                  pathExprSegment
                                                                    pathIdentSegment
                                                                      identifier
                                                                        DEV_MEM
                                                            .
                                                            pathExprSegment
                                                              pathIdentSegment
                                                                identifier
                                                                  bits
                                                            (
                                                            )
                                                          ,
                                                          expression
                                                            literalExpression
                                                              true
                                                        )
                                                  }
                                            matchArm
                                              pattern
                                                patternNoTopAlt
                                                  patternWithoutRange
                                                    wildcardPattern
                                                      _
                                            =>
                                            expression
                                              (
                                              )
                                            ,
                                          }
                                  expression
                                    expression
                                      pathExpression
                                        pathInExpression
                                          pathExprSegment
                                            pathIdentSegment
                                              identifier
                                                Grant
                                          ::
                                          pathExprSegment
                                            pathIdentSegment
                                              identifier
                                                physmap
                                    (
                                    callParams
                                      expression
                                        expression
                                          pathExpression
                                            pathInExpression
                                              pathExprSegment
                                                pathIdentSegment
                                                  identifier
                                                    Frame
                                              ::
                                              pathExprSegment
                                                pathIdentSegment
                                                  identifier
                                                    containing
                                        (
                                        callParams
                                          expression
                                            expression
                                              pathExpression
                                                pathInExpression
                                                  pathExprSegment
                                                    pathIdentSegment
                                                      identifier
                                                        PhysicalAddress
                                                  ::
                                                  pathExprSegment
                                                    pathIdentSegment
                                                      identifier
                                                        new
                                            (
                                            callParams
                                              expression
                                                pathExpression
                                                  pathInExpression
                                                    pathExprSegment
                                                      pathIdentSegment
                                                        identifier
                                                          physical_address
                                            )
                                        )
                                      ,
                                      expression
                                        expression
                                          pathExpression
                                            pathInExpression
                                              pathExprSegment
                                                pathIdentSegment
                                                  identifier
                                                    PageSpan
                                              ::
                                              pathExprSegment
                                                pathIdentSegment
                                                  identifier
                                                    new
                                        (
                                        callParams
                                          expression
                                            pathExpression
                                              pathInExpression
                                                pathExprSegment
                                                  pathIdentSegment
                                                    identifier
                                                      dst_page
                                          ,
                                          expression
                                            expression
                                              pathExpression
                                                pathInExpression
                                                  pathExprSegment
                                                    pathIdentSegment
                                                      identifier
                                                        page_count
                                            .
                                            pathExprSegment
                                              pathIdentSegment
                                                identifier
                                                  get
                                            (
                                            )
                                        )
                                      ,
                                      expression
                                        pathExpression
                                          pathInExpression
                                            pathExprSegment
                                              pathIdentSegment
                                                identifier
                                                  page_flags
                                      ,
                                      expression
                                        pathExpression
                                          pathInExpression
                                            pathExprSegment
                                              pathIdentSegment
                                                identifier
                                                  dst_mapper
                                      ,
                                      expression
                                        pathExpression
                                          pathInExpression
                                            pathExprSegment
                                              pathIdentSegment
                                                identifier
                                                  dst_flusher
                                      ,
                                    )
                                }
                      ,
                    )
                  ?
                ;
            expression
              expression
                pathExpression
                  pathInExpression
                    pathExprSegment
                      pathIdentSegment
                        identifier
                          Ok
              (
              callParams
                expression
                  expression
                    expression
                      pathExpression
                        pathInExpression
                          pathExprSegment
                            pathIdentSegment
                              identifier
                                base_page
                    .
                    pathExprSegment
                      pathIdentSegment
                        identifier
                          start_address
                    (
                    )
                  .
                  pathExprSegment
                    pathIdentSegment
                      identifier
                        data
                  (
                  )
              )
          }
  <EOF>
